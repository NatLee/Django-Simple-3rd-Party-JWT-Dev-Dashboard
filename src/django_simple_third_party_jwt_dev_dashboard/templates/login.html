{% extends "base.html" %}
<!--              -->
{% load bootstrap3 %}
<!--              -->
{% block title %} Login {% endblock %}
<!--              -->
{% block content %}

<div class="kpx_login">
  <h3 class="kpx_authTitle">Login</h3>
  <div class="row kpx_row-sm-offset-3">
    <div class="col-xs-12 col-sm-6">
      <form class="kpx_loginForm" autocomplete="off" method="POST">
        {% csrf_token %}
        <!--              -->
        {% bootstrap_form form %}
        <input type="hidden" name="next" value="{{ next }}" />
        <hr />
        {% buttons %}
        <button type="submit" class="btn btn-lg btn-outline-primary btn-block">
          <i class="glyphicon glyphicon-log-in" id="btn-submit"></i>
          JWT Login
        </button>
        {% endbuttons %}
      </form>
    </div>
  </div>
</div>

<script>
  $("form").on("submit", function (event) {
    event.preventDefault();

    $.ajax({
      type: "POST",
      url: "/{{ jwt_token_url }}",
      data: $(this).serialize(),
      success: function (data) {
        localStorage.setItem('refresh_token', data.refresh);
        localStorage.setItem('access_token', data.access);
        window.location.href = "/{{ dashboard_url }}";
      },
    });
  });
</script>

{% endblock %}
